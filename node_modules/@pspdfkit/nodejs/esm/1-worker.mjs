var X=(s=function(e){if("u">typeof require)return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')},"u">typeof require?require:"u">typeof Proxy?new Proxy(s,{get:(e,t)=>("u">typeof require?require:e)[t]}):s),p={BUNDLE:"/vendor",BACKEND_BUILD:"true",GDPICTURE_HASH:"1ffebe20dea1402281b74ef0efe867af52331c9a"},oe=function e(t){let n;return Object.setPrototypeOf(n=t instanceof Error?t:Error(t),e.prototype),n};oe.prototype=Object.create(Error.prototype,{name:{value:"PSPDFKitError",enumerable:!1}});var J=oe;function l(e,t){if(!e)throw new J(`Assertion failed: ${t||"Condition not met"}

For further assistance, please go to: https://pspdfkit.com/support/request`)}var se={};function L(){return W||(p.STANDALONE_NATIVE&&(console.log("Creating UWP Bridge"),W=new se),W)}function h(e){p.STANDALONE_NATIVE?L().log(e):console.log(e)}function v(e){p.STANDALONE_NATIVE?L().warn(e):console.warn(e)}function A(e){p.STANDALONE_NATIVE?L().error(JSON.stringify(e)):console.error(e)}var ie=["a[href]","area[href]","input:not([disabled])","select:not([disabled])","textarea:not([disabled])","button:not([disabled])","iframe","object","embed","[contenteditable]",'[tabindex]:not([tabindex^="-"])'],De=ie.join(",");function H(e){return{name:e.name,scale:{unitFrom:e.scale.unitFrom,unitTo:e.scale.unitTo,from:Number(e.scale.fromValue),to:Number(e.scale.toValue)},precision:e.precision}}var ae="b94a252b83dc6112",ce="706fa7e936f61d7f";function Y(e){return Promise.resolve(X(e))}function q(e){return"object"==typeof window?new Promise((t,n)=>{let r=document.createElement("script");r.type="text/javascript",r.async=!0,r.onload=()=>t(window.PSPDFModuleInit),r.onerror=n,r.src=e;let{documentElement:o}=document;l(o),o.appendChild(r)}):(self.importScripts(e),Promise.resolve(self.PSPDFModuleInit))}z="object"==typeof process&&"object"==typeof process.versions&&"u">typeof process.versions.node||"u">typeof window&&"Deno"in window||"u">typeof self&&"Deno"in self?Y:q;var le=z,pe=!0,we=!1,ue=pe&&we,me=pe?`${p.BUNDLE}/`:"",Ce=`${me}pspdfkit${ue?"-"+ce:""}.wasm.js`,de=`${me}pspdfkit${ue?"-"+ae:""}.wasm`;function fe(e,t,n=globalThis){let r,o;return new Promise(async a=>{r=Re(e,t),o="string"==typeof e?await le(`${e}${Ce}`):(await import(e.wasmLoaderPath)).default,h("Using WASM method"),ve(n),a({nativeModule:await o(r)})})}function Re(e,t){return"object"==typeof e?{wasmBinaryFile:de,locateFile:e=>e,wasmBinary:e.wasm}:{wasmBinaryFile:e+de,locateFile:e=>e,wasmBinary:X("fs").readFileSync("./vendor/pspdfkit.wasm")}}function ve(e){e.PSPDFLoggingServices={error(e,t){A(`[${e}] ${t}`)},warn(e,t){v(`[${e}] ${t}`)},info(e,t){p.INTERNAL_DEBUG&&h(`[${e}] ${t}`)},debug(e,t){p.INTERNAL_DEBUG&&h(`[${e}] ${t}`)},trace(e,t){p.INTERNAL_DEBUG&&h(`[${e}] ${t}`)}}}function j(e){let t=new FileReader;return new Promise((n,r)=>{t.onerror=e=>{r(Error(e))},t.onload=e=>{n(new Uint8Array(e.target?.result))},t.readAsArrayBuffer(e)})}var ge={TEXT:"text",PRESET:"preset",REGEX:"regex"},b={documentA:"documentA",documentB:"documentB",result:"result"},Hn=p.STANDALONE_NATIVE?4:2,Gn=p.STANDALONE_NATIVE?2048:512,Xn=96/72,ke=150,Be=300,Yn=ke/72,qn=Be/72,zn=75/72,Zn={LOW:75/72,MEDIUM:150/72,HIGH:300/72},Qn=2/3,Me=2,Je=96,er=Me*Je,Z=16383,U={SharePoint:"SharePoint",Salesforce:"Salesforce",Maui_Android:"Maui_Android",Maui_iOS:"Maui_iOS",Maui_MacCatalyst:"Maui_MacCatalyst",Maui_Windows:"Maui_Windows"},Q={cms:"cms",cades:"cades",documentTimestamp:"documentTimestamp"},_="/create.pdf",T="/save.pdf",G="/embedded.pdf",ye=1,M=!1,F="WebAssembly module not loaded.",u=null,_e=!1,D=!1,ee=null,te=[],N=null,ne=null;function Ne(e){return null!=e&&null!=e.length&&0===e.length}var Te=["configurePDFJavaScriptSupport","closeDocument","setFormValues","openDocument","saveDocument","importXFDF","importInstantDocumentJSON"],Le={annotationsAndForms:"annotations_and_forms",assemble:"assemble",extract:"extract",extractAccessibility:"extract_accessibility",fillForms:"fill_forms",modification:"modification",printHighQuality:"print_high_quality",printing:"printing"};function m(e,...t){let n;l(u,"WebAssembly module not loaded."),l(u[e],`Native module does not implement ${e}.`),M&&(n=performance.now(),h(`Request: ${e}(${t.map(e=>JSON.stringify(e)).join(", ")})`));let r=t.map(e=>Ne(e)?JSON.stringify(e):e);Te.includes(e)&&V();let o=JSON.parse(u[e](...r)||'{ "success": true }');if(M&&(l("number"==typeof n),h(`Response from ${e} (${(performance.now()-n).toFixed(2)} ms): ${JSON.stringify(o)}`)),!o.success)throw Error(o.error);return o}function Ee(e,...t){let n;l(u,"WebAssembly module not loaded."),l(u[e],`Native module does not implement ${e}.`),M&&(n=performance.now(),h(`Request: ${e}(${t.map(e=>JSON.stringify(e)).join(", ")})`)),Te.includes(e)&&V();let r=t.map(e=>Ne(e)?JSON.stringify(e):e),o=u[e](...r);return M&&(l("number"==typeof n),h(`Response from ${e} (${(performance.now()-n).toFixed(2)} ms): ${JSON.stringify(o)}`)),o}var je=["run_pdf_formatting_scripts","run_pdf_javascript","set_form_values_get_script_changes","edit_document","prepare_sign","sign","on_keystroke_event","save_document"];function Ue(e){let t=new ArrayBuffer(2*e.length),n=new Uint16Array(t);for(let t=0,r=e.length;t<r;t++)n[t]=e.charCodeAt(t);return t}function c(e,t={},n=null){let r;l(u,"WebAssembly module not loaded.");let o=JSON.stringify({type:e,...t}),a;if(M&&(a=performance.now(),h(`Request: dispatchCommand(${o})`)),je.includes(e)&&V(),n)try{let e=new Uint8Array("string"==typeof n?Ue(n):n),t=u.allocateMemory(e.byteLength);try{u.HEAPU8.set(e,t.ptr);let n=t.toVector();try{r=u.dispatchCommandWithBinary(o,n)}finally{n.delete()}}finally{t.delete()}}catch(e){throw e}else r=u.dispatchCommand(o);if(r.hasError()){let t=Error(r.getErrorMessage()||"There was an error while executing the command: "+e);throw r.delete(),t}let i=[];for(let e=0;e<r.getRepliesCount();e++)r.hasJSONReply(e)&&i.push(JSON.parse(r.getJSONReply(e))),r.hasBinaryReply(e)&&i.push(r.getBinaryReply(e).slice(0));return M&&(l("number"==typeof a),h(`Response from ${e} (${(performance.now()-a).toFixed(2)} ms): ${JSON.stringify(i)}`)),r.delete(),i}function Se(e){try{let t=new TextDecoder().decode(e);return JSON.parse(t)}catch(e){throw e}}function $(e,t){return`${e}/${t}.pdf`}function $e(e,t,n){return l(u,F),u.FS.analyzePath(e).exists||u.FS.mkdir(e),u.FS.writeFile($(e,t),n),t}function Ke(e,t){l(u,F),u.FS.unlink($(e,t))}async function he(e,t){let n=Math.random().toString(36).slice(-5),r=await Promise.all(Object.entries(t).map(async([t,r])=>(e.forEach(e=>{"document"in e&&e.document===t&&"importDocument"===e.type?(!1===e.treatImportedDocumentAsOnePage&&(e.treatImportedDocumentAsOnePage=void 0),e.document=$(n,t)):("dataFilePath"in e&&e.dataFilePath===t&&"applyInstantJson"===e.type||"dataFilePath"in e&&e.dataFilePath===t&&"applyXfdf"===e.type)&&(e.dataFilePath=$(n,t))}),{basename:t,buffer:await j(r)})));return r.forEach(e=>{$e(n,e.basename,e.buffer)}),function(){r.forEach(e=>{Ke(n,e.basename)})}}async function Ve(e,t){l(u,F),u.FS.mkdir(t),e.forEach(e=>{u.FS.writeFile(`${t}/${e.name}`,new Uint8Array(e.data))})}function k(){D=!0;let e=m("configurePDFJavaScriptSupport",!0);return l(e.success,"An error occurred while executing the document level JavaScript."),e.changes||[]}function Oe(e,t){let n;try{n=c("edit_document",{save_path:t,operations:e})}catch(e){throw Error(`Error applying operations to document: ${e.message}`)}return n}var s,W,z,B,x=null,O=!1;function V(){O||(x=null,B=!1)}function R(e){O&&!e&&(O=!1,x&&P(x)),O=e}function I(){return null===x&&(x=c("read_form_json_objects"),B=!1),x}function P(e){if(O){if(null===e)throw O=!1,Error("Error enqueuing form JSON objects: form fields JSON is null.");x&&!B&&(B=!0),x=e;return}if(B||!O)try{V(),c("apply_form_json_objects",{form_fields_with_widgets:e})}catch(e){throw Error("Error applying form JSON objects to "+_+": "+e.message)}}function be(e,t,n,r,o,a){l("number"==typeof e.pageIndex,"Annotation must have a pageIndex");try{return l("number"==typeof e.pdfObjectId,"Cannot call renderAnnotation() for an annotation without pdfObjectId."),c("render_annotation",{page:e.pageIndex,annotation_id:e.pdfObjectId,format:o,bitmap_width:n,bitmap_height:r,appearance_stream_type:a||"normal"})[0]}catch(e){A(e.message);return}}function We(e=[],t=[]){e.push("pspdfkit/widget"),m("removeAllAnnotations",JSON.stringify(e),JSON.stringify(t))}var Ie={SharePoint:"SPO",Salesforce:"SF",[U.Maui_iOS]:"MauiIOS",[U.Maui_Android]:"MauiAndroid",[U.Maui_MacCatalyst]:"MauiMacCatalyst",[U.Maui_Windows]:"MauiWindows",NodeJS:"NodeJS"},K=class{constructor(){this._pdfObjectIdsForIds={},this.comparisonDocuments={},this.lastOpenedComparisonDocument=null,this.persistedOpenDocument=null}loadNativeModule(e,{disableWebAssemblyStreaming:t,enableAutomaticLinkExtraction:n,overrideMemoryLimit:r}){return ne=Date.now(),_e=n,ee=r,fe(e,t).then(({nativeModule:e})=>{u=e;let t=m("PSPDFKitVersion").version;if(t!==ye)throw Error(`Native version mismatch. Please update the dependencies. Expected ${ye} but got ${t}.`);p.INTERNAL_DEBUG&&m("setLogLevel","debug")})}async load(e,t,{mainThreadOrigin:n,customFonts:r,productId:o}){let a;l(u,F);try{let e=r?"/fonts":"";r&&!u.FS.analyzePath(e).exists&&await Ve(r,e),a=u.initPSPDFKit(t??"",n,e,"",o&&"u">typeof Ie[o]?Ie[o]:"")}catch(e){throw e}let i=JSON.parse(a);if(ne&&h(`Native initialization complete, took: ${Date.now()-ne}ms`),!i.success)throw Error("Failed to initialize PSPDFKit: "+i.error);return i}async openDocument(e,t,n){try{return l(u,F),null!==ee&&m("overrideMemoryLimit",ee),N=t,u.FS.writeFile(_,new Uint8Array(e)),this.openAndReturnDocumentInfo(n)}finally{this._pdfObjectIdsForIds={}}}async getAvailableFontFaces(e){if(!e)return[];let t=e?"/fonts/":"";return c("get_available_font_faces")[0]?.font_faces.reduce((n,r)=>{let o=e.find(e=>e.name===r.path.replace(t,""));return o?n.concat({readableName:r.fullName,name:o.name}):n},[])}async reloadDocument(){try{return R(!1),m("closeDocument"),this.openAndReturnDocumentInfo()}finally{this._pdfObjectIdsForIds={}}}async openAndReturnDocumentInfo(e){m("openDocument",_,JSON.stringify({password:N})),D&&k(),m("automaticLinkExtraction",_e);let t=m("getDocumentInfo").documentInfo;if(t.pageCount<=0)return t;let n=[];if("number"==typeof e){let r=await this.getPageInfo(e);for(let o=0;o<t.pageCount;o++){let t={...r,pageIndex:o,pageLabel:e===o?r.pageLabel:String(o+1)};n.push(t)}}else n=await this.getAllPageInfos(t.pageCount);return t.pages=n,t}async getPageInfo(e){try{let t=c("page_info",{query:"page_info",page:e});l(1===t.length,"expected page_info result to return 1 result when specifying index.");let n=new TextDecoder().decode(t[0]);return JSON.parse(n).pageInfo}catch{return A(`Dimensional information for page ${e} unavailable, page will not be displayed.`),{height:0,matrix:[0,0,0,0,0,0],pageLabel:"",reverseMatrix:[0,0,0,0,0,0],transformedBBox:[0,0,0,0],untransformedBBox:[0,0,0,0],width:0,pageIndex:e,rawPdfBoxes:{bleedBox:null,cropBox:null,mediaBox:null,trimBox:null}}}}async getAllPageInfos(e){let t=[];try{let n=c("page_info",{query:"page_info",page:"all"});l(n.length===e,"expected the same length of page info response to page count.");for(let e=0;e<n.length;e++){let r=new TextDecoder().decode(n[e]),o=JSON.parse(r);t.push(o.pageInfo)}}catch{A("There was an error retrieving page information for all pages from core. Reverting to individual queries.");for(let n=0;n<e;n++)try{let e=c("page_info",{query:"page_info",page:n});l(1===e.length,"expected page_info result to return 1 result when specifying index.");let r=new TextDecoder().decode(e[0]),o=JSON.parse(r);t.push(o.pageInfo)}catch{A(`Dimensional information for page ${n} unavailable, page will not be displayed.`);let e={height:0,matrix:[0,0,0,0,0,0],pageLabel:"",reverseMatrix:[0,0,0,0,0,0],transformedBBox:[0,0,0,0],untransformedBBox:[0,0,0,0],width:0,pageIndex:n,rawPdfBoxes:{bleedBox:null,cropBox:null,mediaBox:null,trimBox:null}};t.push(e)}}return t}async enablePDFJavaScriptSupport(){return k()}async runPDFFormattingScripts(e,t){let n;l(D,"PDF Formatting Scripts can only run after JavaScript is enabled.");try{n=c("run_pdf_formatting_scripts",{form_fqns:e,only_if_no_ap_stream:t})}catch(e){throw Error(`An error occurred while executing the document level JavaScript formatting.

`+e.message)}return n[0].changes||[]}async openDocumentAt(){throw Error("Should never be called")}async getBookmarks(){let e=c("get_bookmarks");return l(1===e.length,"expected only one response for getBookmarks"),e[0].bookmarks||[]}async getFormJSON(){return m("getFormJSON").formJSON}async getFormValues(){return m("getFormValues").formValues}async setFormValues(e){let t=I(),n=!1,r=t.map(t=>{let r=e.find(e=>e.name===t.formField.name);return r?r.value===t.value||Array.isArray(r.value)&&Array.isArray(t.value)&&r.value.every((e,n)=>e===t.value[n])?t:(n=!0,{...t,value:r.value}):t});n&&P(r)}async setFormFieldValue(e){await this.setFormValues([e])}async applyOperations(e,t){let n=await he(e,t);Oe(e,_),n()}async exportPDFWithOperations(e,t){let n=await he(e,t),r;l(u,F);try{Oe(e,T),r=u.FS.readFile(T).buffer}catch(e){throw Error("Error applying operations: "+e.message)}return n(),r}async getSignaturesInfo(){try{return c("get_signatures",{certificate_check_time:"current_time"})[0]}catch(e){throw Error(`Error getting signatures info: ${e.message}`)}}async getComments(){try{return c("get_comments")}catch(e){throw Error(`Error getting comments: ${e.message}`)}}async applyComments(e){try{return c("apply_comments",{comments:e})}catch(e){throw Error(`Error applying comments: ${e.message}`)}}async prepareSign(e,t,n,r,o,a,i){let d,f;try{f=c("get_signatures",{certificate_check_time:"current_time"})[0];let e="not_signed"!==f.status;m("saveDocument",T,!1,e,!1,!1,"pdf",!1),m("openDocument",T,JSON.stringify({password:N}))}catch(e){throw Error(`Error saving document backup for invisible signing: ${e}`)}try{let e=!n&&"not_signed"!==f.status;m("saveDocument",_,n,e,!1,!1,"pdf",!1),n&&(m("openDocument",_,JSON.stringify({password:N})),D&&k())}catch(e){throw Error(`Error saving document for invisible signing: ${e}`)}try{d=c("prepare_sign",{signer_data_source:{...e,field_name:r,position:o,appearance:a,type:"pspdfkit/signer-data-source"},signature_metadata:{...t,type:"pspdfkit/signature-metadata"}},i)}catch(e){throw Error(`Error preparing document for signing: ${e}`)}l(u,F);let g=null;return e&&e?.signatureType!==Q.cms||(g=u.FS.readFile(d[0].result.file_contents).buffer),u.FS.unlink(d[0].result.file_contents),{file:d[0].result.file,hash:d[0].result.hash,signatureFormFieldName:d[0].result.signature_form_fqn,dataToBeSigned:d[0].result.data_to_be_signed,fileContents:g}}async sign(e,t,n,r,o,a){let i;try{let d;r===Q.cades&&Array.isArray(a)&&a.length>0&&(d=c("create_signature",{signatureType:r,hash:n,signed_data:o,certificates:a})),i=c("sign",{password:N,save_path:_,file_path:e,signature_form_fqn:t,pkcs7_container:d?.[0].result||o}),m("openDocument",_,JSON.stringify({password:N})),D&&k()}catch(e){throw Error(`Error signing document: ${e}`)}return i[0].result}async restoreToOriginalState(){try{m("openDocument",T,JSON.stringify({password:N})),D&&k();let e=c("get_signatures",{certificate_check_time:"current_time"})[0],t="not_signed"!==e.status;m("saveDocument",_,!1,t,!1,!1,"pdf",!1),m("openDocument",_,JSON.stringify({password:N})),D&&k()}catch(e){throw Error(`Could not restore backup document: ${e}`)}}async evalFormValuesActions(e){let t=c("set_form_values_get_script_changes",{form_values:e});return l(1===t.length,"expected only one response for evalFormValuesActions"),t[0].changes}async readFormJSONObjects(){return I()}async setFormJSONUpdateBatchMode(e){await R(e)}async evalScript(e,t){let n=c("run_pdf_javascript",{pdf_javascript_contents:e,pdf_javascript_form_fqn:t});return l(1===n.length,"expected only one response for evalScript"),n[0].changes}async closeDocument(){try{return te=[],N=null,D=!1,x=null,O=!1,B=!1,m("closeDocument")}finally{this._pdfObjectIdsForIds={}}}async renderTile(e,t,n,r,o,a,i,d){return l(u,F),c("render_tile",{render_annotations:!!(a||i),print_rendering:r,page:e,bitmap_width:n.width,bitmap_height:n.height,bitmap_x:n.left,bitmap_y:n.top,page_width:t.width,page_height:t.height,format:Fe(d,{width:n.width,height:n.height}),render_text:o})[0]}async renderAnnotation(e,t,n,r,o,a){return be({...e,pdfObjectId:this._getPdfObjectIdForObject(e)},t?await j(t):null,n,r,o,a)}async renderPageAnnotations(e,t,n,r,o){return t.map((t,a)=>be({pdfObjectId:t,pageIndex:e},null,n[a],r[a],Fe(o,{width:n[a],height:r[a]})))}async renderDetachedAnnotation(e,t,n,r,o){l(u,F);let a=t?await j(t):null,i=t?t.type:null,d,f,g=new u.VectorUint8;try{if(null!=a)for(let e=0;e<a.byteLength;e++)g.push_back(a[e]);if((f=Ee("renderDetachedAnnotation",o,JSON.stringify({...e,pdfObjectId:this._getPdfObjectIdForObject(e),pageIndex:0}),0,n,r,g,i||"")).hasError()||1!==f.getRepliesCount()){let e=f.getErrorMessage(),t=f.getErrorReason();throw Error(t+": "+e)}d=f.getBinaryReply(0).slice(0)}finally{g&&g.delete(),f&&f.delete()}return d}async loadCertificates(e){if(c("load_certificates",{certificates:e}).length>0)throw new J("Internal error while loading certificates")}async getAttachment(e){let t,n,r,o=(await this.getEmbeddedFilesList())?.map(e=>e.id)?.includes(e);try{if(o)c("extract_embedded_file",{id:e,file_path:G}),t=u.FS.readFile(G).buffer;else if((n=Ee("getAnnotationAttachment",e)).hasError()||1!==n.getRepliesCount()){let e=n.getErrorMessage(),t=n.getErrorReason();throw Error("Error fetching attachment: "+t+", "+e)}else r=JSON.parse(n.getJSONReply(0)).encoding,t=n.getBinaryReply(0).slice(0)}finally{u.FS.analyzePath(G)?.exists&&u.FS.unlink(G),n&&n.delete()}return[t,r]}async textForPageIndex(e){return m("textForPageIndex",e).textBlocks}async textContentTreeForPageIndex(e){return c("get_content_tree",{pageIndex:e})}async annotationsForPageIndex(e){let t=m("annotationsForPageIndex",e);return["rollover","down"].forEach(e=>{t.apstream_variants?.[e]?.forEach(n=>{let r=t.annotations.find(e=>e.pdfObjectId===n);r?r[e]=!0:t.annotations.push({pdfObjectId:n,[e]:!0})})}),t.annotations}async createAnnotation(e,t){l(u,F),l("number"==typeof e.pageIndex,"Annotation must have a pageIndex");let n=e.pdfObjectId,r=t?await j(t):null,o,a=new u.VectorUint8;try{if(null!=r)for(let e=0;e<r.byteLength;e++)a.push_back(r[e]);"pspdfkit/widget"===e.type&&(R(!1),V());let t=("pspdfkit/shape/ellipse"===e.type||"pspdfkit/shape/rectangle"===e.type)&&e.measurementScale?{...e,measurementBBox:e.bbox}:e;o=m("createAnnotation",JSON.stringify({...t,pdfObjectId:null}),a)}finally{a&&a.delete()}return"number"==typeof n&&"number"==typeof this._pdfObjectIdsForIds[n.toString()]&&delete this._pdfObjectIdsForIds[n.toString()],this._pdfObjectIdsForIds[e.id||o.pdfObjectId.toString()]=o.pdfObjectId,o.pdfObjectId}async updateAnnotation(e){let t={...e,pdfObjectId:this._getPdfObjectIdForObject(e)};if(l(t.id,"Annotation must have an ID"),l("number"==typeof t.pageIndex,"Annotation must have a pageIndex"),"pspdfkit/widget"===t.type){let e=I(),n="number"==typeof t.pdfObjectId?t.pdfObjectId.toString():t.id;P(e.map(e=>e.formField.annotationIds.includes(n)||e.formField.annotationIds.includes(String(t.pdfObjectId))?{...e,widgets:e.widgets.map(e=>e.id===n||String(e.pdfObjectId)===n?t:e)}:e))}else m("updateAnnotation",JSON.stringify(t),0,0)}async deleteAnnotation(e){if(e.APStreamCache&&await this.updateAnnotation(e),"pspdfkit/widget"===e.type)try{let t=e.id,n=I();P(n.map(n=>{if(n.formField.annotationIds.includes(t)||n.formField.annotationIds.includes(String(e.pdfObjectId))){let e;if(("pspdfkit/form-field/checkbox"===n.formField.type||"pspdfkit/form-field/radio"===n.formField.type)&&n.formField.options.length===n.formField.annotationIds.length){let r=n.formField.annotationIds.indexOf(t);e=n.formField.options.filter((e,t)=>t!==r)}let r=n.widgets.filter(e=>t!==(e.id||String(e.pdfObjectId))),o=n.formField.annotationIds.filter(e=>e!==t);return r.length>0&&o.length>0?{...n,formField:{...n.formField,annotationIds:o,...e?{options:e}:null},widgets:r}:null}return n}).filter(Boolean))}catch(e){throw e}else try{c("remove_annotations",{annotation_ids:[this._getPdfObjectIdForObject(e)]})}catch{v(`Removing annotation failed for annotation: ${JSON.stringify(e)}`)}delete this._pdfObjectIdsForIds[e.id||e.pdfObjectId?.toString()]}async createFormField(e,t){let n=I().concat([{type:"pspdfkit/form-field-with-widgets",formField:e,widgets:t}]),r=O;O&&R(!1),P(n);let o=I();r&&R(!0);let a=o.find(t=>t.formField.name===e.name);if(!a)throw Error(`Error creating new form field in ${_}: created form field not found. ${JSON.stringify({type:"pspdfkit/form-field-with-widgets",formField:e,widgets:t})}`);a.widgets.forEach(e=>{this._pdfObjectIdsForIds[e.id]=e.pdfObjectId}),"number"==typeof e.pdfObjectId&&"number"==typeof this._pdfObjectIdsForIds[e.pdfObjectId.toString()]&&delete this._pdfObjectIdsForIds[e.pdfObjectId.toString()],this._pdfObjectIdsForIds[e.id||a.formField.pdfObjectId.toString()]=a.formField.pdfObjectId}async updateFormField(e,t){let n={...e,pdfObjectId:this._pdfObjectIdsForIds[e.id]||this._getPdfObjectIdForObject(e)},r=I(),o=r.find(e=>Ae(e.formField,n));if(!o)throw Error(`Error updating form field with name "${e.name}" in ${_}: form field not found. ${JSON.stringify(r)}`);let a=o.formField.name!==e.name,i=null;if(a&&"pspdfkit/form-field/radio"===n.type){let o=e.name,a=r.find(e=>e.formField.name===o);a&&"pspdfkit/form-field/radio"===a.formField.type&&(n={...n,annotationIds:[...n.annotationIds,...a.formField.annotationIds],options:[...n.options,...a.formField.options]},t=[...t,...a.widgets],i=a)}P(r.map(r=>{if(i&&i.formField.pdfObjectId===r.formField.pdfObjectId)return null;if(!Ae(r.formField,n))return r;{let o={type:"pspdfkit/form-field-with-widgets",formField:{...r.formField,...n},widgets:t.reduce((e,t)=>[...e,{...r.widgets.find(e=>e.id===t.id||e.pdfObjectId===t.pdfObjectId),...t}],[]),..."u">typeof r.value?{value:r.value}:null};return e.flags||delete o.formField.flags,o}}).filter(Boolean));let d=I().find(t=>t.formField.name===e.name);if(!d)throw Error(`Error updating form field "${e.name}" in ${_}: updated form field not found. ${JSON.stringify({type:"pspdfkit/form-field-with-widgets",formField:e,widgets:t})}`);d.formField.pdfObjectId!==n.pdfObjectId&&(this._pdfObjectIdsForIds[n.id]=d.formField.pdfObjectId),o?.widgets.forEach(e=>{t.some(t=>t.id===e.id)||delete this._pdfObjectIdsForIds[e.id]})}async deleteFormField(e){let t=I(),n=t.find(t=>t.formField.name===e.name);if(!n)return;P(t.filter(t=>t.formField.name!==e.name));let r=I().find(t=>t.formField.name===e.name);if(r)throw Error(`Error deleting form field with name "${e.name}" in ${_}: form field still present. ${JSON.stringify(r)}`);n.widgets.forEach(e=>{delete this._pdfObjectIdsForIds[e.id]})}async deleteFormFieldValue(e){P(I().map(t=>t.formField.name===e?{formField:t.formField,widgets:t.widgets,type:t.type}:t))}async createBookmark(e){try{c("append_bookmarks",{bookmarks:[e]})}catch(e){throw Error(`Error creating new bookmark in ${_}: ${e.message}`)}}async updateBookmark(e){try{c("remove_bookmarks",{bookmarkIds:[e.id??e.pdfBookmarkId]}),c("append_bookmarks",{bookmarks:[e]})}catch(e){throw Error(`Error updating bookmark in ${_}: ${e.message}`)}}async deleteBookmark(e){try{c("remove_bookmarks",{bookmarkIds:[e]})}catch(e){throw Error(`Error deleting bookmark in ${_}: ${e.message}`)}}async getTextFromRects(e,t){return m("getTextFromRects",e,JSON.stringify(t.map(e=>[e.left,e.top,e.width,e.height]))).text}async search(e,t,n,r,o=ge.TEXT){return c("search",{query:e,start_index:t,limit:n,case_sensitive:r,search_type:o})}async parseXFDF(e){try{let t=c("convert_xfdf_to_instant_json",void 0,e);return Se(t[0])}catch(e){throw e}}async getEmbeddedFilesList(){return c("list_embedded_files")[0].embeddedFiles||null}async getMeasurementSnappingPoints(e){let t=c("get_snapping_points",{page:e});return t[0].snappingPoints?He(t[0].snappingPoints):null}async getSecondaryMeasurementUnit(){try{return c("get_secondary_measurement_unit")[0]||null}catch(e){throw Error(`Error getting secondary measurement: ${e.message}`)}}async setSecondaryMeasurementUnit(e){try{c("set_secondary_measurement_unit",e?{unitTo:e?.unitTo,precision:e?.precision}:null)}catch{v("Error setting secondary measurement unit")}}async getMeasurementScales(){try{return c("get_measurement_content_formats")[0]||null}catch(e){throw Error(`Error getting measurement scales: ${e.message}`)}}async removeMeasurementScale(e){try{c("remove_measurement_content_format",{measurementContentFormat:H(e)})}catch(t){throw Error(`Error removing ${e.name} measurement scale: ${t.message}`)}}async addMeasurementScale(e){try{c("add_measurement_content_format",{measurementContentFormat:H(e)})}catch(t){throw Error(`Error adding ${e.name} measurement scale: ${t.message}`)}}async getAnnotationsByScale(e){try{return c("get_annotations_for_measurement_content_format",{measurementContentFormat:H(e)})||null}catch(e){throw e}}async exportFile(e,t,n,r,o,a,i){let d={mimeType:"application/pdf",extension:"pdf"};try{let f=c("save_document",{file_path:T,format:r,flatten_annotations:e,save_incrementally:t,apply_redactions:!1,save_for_printing:n,remove_all_annotations:o,preserve_change_tracker_state:a,...i?{user_password:i.userPassword,owner_password:i.ownerPassword,document_permissions:Ge(i.documentPermissions)}:null})[0];f.format&&(d={mimeType:f.format.mime_type,extension:f.format.extension})}catch(e){throw Error(`Error saving to ${T}: ${e.message}`)}return l(u,F),[u.FS.readFile(T).buffer,d]}async importXFDF(e,t){te.push({source:e,keepCurrentAnnotations:t}),t||We(),m("importXFDF",e)}async exportXFDF(){return m("exportXFDF",[],[]).XFDF}async importInstantJSON(e){m("importInstantDocumentJSON",JSON.stringify(e))}async exportInstantJSON(e){let t=O;O&&R(!1);let n=c("export_document_json","number"==typeof e?{version:{annotations:e}}:void 0);return t&&R(!0),Se(n[0])}async getDocumentOutline(){let e=c("get_outline");return l(1===e.length,"expected only one response for getDocumentOutline"),e[0].outline||[]}async getPageGlyphs(e){return c("get_glyphs",{page:e})[0].glyphs||[]}async onKeystrokeEvent(e){let t=c("on_keystroke_event",{pdf_javascript_event:e});l(1===t.length,"expected only one response for onKeystrokeEvent");let n=t[0].changes||[];return l(n.length>0&&4===n[0].change_type,"expected onKeystrokeEvent to return at least one JavaScript Event change."),n}async version(){return m("PSPDFKitVersion").version}getImportedXFDF(){return te}async applyRedactions(){try{m("saveDocument",_,!1,!1,!0,!1,"pdf",!1)}catch(e){throw Error(`Error applying redactions and saving to ${_}: ${e.message}`)}}async clearAPStreamCache(){m("clearAPStreamCache")}async setComparisonDocument(e,t){this.comparisonDocuments[e]=t||(await this.exportFile(!1,!1,!1,"pdf",!1,!1))[0]}async openComparisonDocument(e){return l(this.comparisonDocuments[e]),e===this.lastOpenedComparisonDocument||e===b.documentA&&null===this.lastOpenedComparisonDocument&&this.persistedOpenDocument instanceof ArrayBuffer?null:(this.lastOpenedComparisonDocument=e,this.openDocument(this.comparisonDocuments[e],this.persistedOpenDocument===e?this.persistedOpenDocumentPassword:void 0))}async documentCompareAndOpen(e){l(this.comparisonDocuments[b.documentA]&&this.comparisonDocuments[b.documentB],"One or both comparison input documents are missing.");let t=`${b.documentA}.pdf`,n=`${b.documentB}.pdf`;return u.FS.writeFile(t,new Uint8Array(this.comparisonDocuments[b.documentA])),u.FS.writeFile(n,new Uint8Array(this.comparisonDocuments[b.documentB])),c("comparison",{documentA:{strokeColor:e.documentA.strokeColor,pageIndex:e.documentA.pageIndex,filePath:t},documentB:{strokeColor:e.documentB.strokeColor,pageIndex:e.documentB.pageIndex,filePath:n},options:{...e.options,outputFilePath:"output.pdf"}}),await this.closeDocument(),this.comparisonDocuments[b.result]=u.FS.readFile("output.pdf").buffer,this.lastOpenedComparisonDocument=b.result,this.openDocument(this.comparisonDocuments[b.result],void 0)}async persistOpenDocument(e){if(e)this.persistedOpenDocument=e;else try{this.persistedOpenDocument=(await this.exportFile(!1,!1,!1,"pdf",!1,!0))[0]}catch(e){throw Error(`Error trying to persist a copy of the currently opened document: ${e.message}`)}this.persistedOpenDocumentPassword=N}async cleanupDocumentComparison(){l(this.persistedOpenDocument,"No persisted previous document key or array buffer is available.");let e=this.persistedOpenDocument instanceof ArrayBuffer?this.persistedOpenDocument:this.comparisonDocuments[this.persistedOpenDocument];l(e,"No persisted previous array buffer is available.");try{await this.closeDocument()}catch(e){throw Error(`Error trying to close the current document: ${e.message}`)}let t=this.openDocument(e,this.persistedOpenDocumentPassword);return this.persistedOpenDocument=null,this.persistedOpenDocumentPassword=null,this.lastOpenedComparisonDocument=null,this.comparisonDocuments={},t}_getPdfObjectIdForObject(e){return"number"==typeof e.pdfObjectId?e.pdfObjectId:this._pdfObjectIdsForIds[e.id]}async contentEditorEnter(){c("content_editing/enter")}async contentEditorExit(){c("content_editing/exit")}async contentEditorGetTextBlocks(e){let t=c("content_editing/get_text_blocks",{pageIndex:e});return l(1===t.length,"expected only one response for getTextBlocks"),t[0]}async contentEditorDetectParagraphs(e){let t=c("content_editing/detect_paragraphs",{pageIndex:e});return l(1===t.length,"expected only one response for detectParagraphs"),t[0]}async contentEditorRenderTextBlock(e,t,n){let r=c("content_editing/render_text_block",{textBlockId:e,renderTextBlockParams:t,externalControlState:n});return l(2===r.length,"expected only two responses for renderTextBlock. ArrayBuffer and Size info."),{imageBuffer:r[1],displayRect:r[0].displayRect}}async contentEditorSetTextBlockCursor(e,t,n,r){let o=c("content_editing/set_cursor",{textBlockId:e,offset:t,selectText:n,externalControlState:r});return l(1===o.length,"expected only one response for setTextBlockCursor"),o[0]}async contentEditorMoveTextBlockCursor(e,t,n,r){let o=c("content_editing/move_cursor",{textBlockId:e,movement:t,selectText:n,externalControlState:r});return l(1===o.length,"expected only one response for moveTextBlockCursor"),o[0]}async contentEditorInsertTextBlockString(e,t,n,r){let o=c("content_editing/insert_text",{textBlockId:e,cluster:t,text:n,externalControlState:r});return l(1===o.length,"expected only one response for insertTextBlockString"),o[0]}async contentEditorInsertTextBlockContentRef(e,t,n,r){let o=c("content_editing/insert_content_ref",{textBlockId:e,cluster:t,contentRef:n,externalControlState:r});return l(1===o.length,"expected only one response for contentEditorInsertTextBlockContentRef"),o[0]}async contentEditorCreateTextBlock(e){let t=c("content_editing/create_text_block",{pageIndex:e});return l(1===t.length,"expected only one response for contentEditorCreateTextBlock"),t[0]}async contentEditorDeleteTextBlockRange(e,t,n){let r=c("content_editing/delete_range",{textBlockId:e,range:t,externalControlState:n});return l(1===r.length,"expected only one response for deleteTextBlockRange"),r[0]}async contentEditorLayoutTextBlock(e,t,n,r){let o=c("content_editing/layout",{textBlockId:e,cursor:t,selection:n,externalControlState:r});return l(1===o.length,"expected only one response for layoutTextBlock"),o[0]}async contentEditorDeleteTextBlockString(e,t,n){let r=c("content_editing/delete_cluster",{textBlockId:e,direction:t,externalControlState:n});return l(1===r.length,"expected only one response for deleteTextBlockString"),r[0]}async contentEditorSetTextBlockSelection(e,t,n){let r=c("content_editing/set_selection",{textBlockId:e,mode:t,externalControlState:n});return l(1===r.length,"expected only one response for setTextBlockSelection"),r[0]}async contentEditorSetTextBlockSelectionRange(e,t,n,r,o){let a=c("content_editing/set_selection_range",{textBlockId:e,begin:t,end:n,mode:r,externalControlState:o});return l(1===a.length,"expected only one response for setTextBlockSelection"),a[0]}async contentEditorTextBlockUndo(e,t){let n=c("content_editing/undo",{textBlockId:e,externalControlState:t});return l(1===n.length,"expected only one response for textBlockUndo"),n[0]}async contentEditorTextBlockRedo(e,t){let n=c("content_editing/redo",{textBlockId:e,externalControlState:t});return l(1===n.length,"expected only one response for textBlockRedo"),n[0]}async contentEditorTextBlockRestore(e,t,n){let r=c("content_editing/restore",{textBlockId:e,version:t,externalControlState:n});return l(1===r.length,"expected only one response for textBlockRestore"),r[0]}async contentEditorTextBlockApplyFormat(e,t,n,r){let o=c("content_editing/apply_format",{textBlockId:e,range:t,formatModifications:n,externalControlState:r});return l(1===o.length,"expected only one response for textBlockApplyFormat"),o[0]}async contentEditorGetAvailableFaces(){let e=c("content_editing/available_faces");return l(1===e.length,"expected only one response for available_faces"),e[0]}async contentEditorSave(e){let t;try{t=c("content_editing/save_to_document",{path:_,textBlockSaveInfos:e})}catch(e){throw Error(`Error saving to ${T}: ${e.message}`)}return t}recycle(){}destroy(){}};function Fe(e,{width:t,height:n}){return"webp"===e&&(t>Z||n>Z)?"png":e}function He(e){let t=[...e.endpoints,...e.intersections,...e.midpoints],n=[];for(let e=0;e<t.length;e+=2){let r=[t[e],t[e+1]];n.push(r)}return n.sort((e,t)=>e[0]==t[0]?e[1]-t[1]:e[0]-t[0])}function Ge(e){let t=[];for(let n=0;n<e.length;n++)t.push(Le[e[n]]);return t}function Ae(e,t){return e.pdfObjectId===t.pdfObjectId}var Xe=new K;self.onmessage=async({data:e})=>{let t,n;try{let r=await Xe[e.action](...e.args);if(t={id:e.id,result:r},Array.isArray(r)){let e=r.filter(e=>e instanceof ArrayBuffer);e.length>0&&(n=e)}r instanceof ArrayBuffer&&(n=[r])}catch(o){let r=[...e.args].filter(e=>e instanceof ArrayBuffer);r.length>0&&(n=r),A("[PSPDFKit Internal Debug]",o.message,o.stack),t={id:e.id,error:o.message||o.toString(),callArgs:e.args}}self.postMessage(t,n)};